# üöÄ –ë—ã—Å—Ç—Ä–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## üìã –ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ:

‚úÖ **–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**
- `users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `orders` - –∑–∞–∫–∞–∑—ã  
- `applicants` - –∑–∞—è–≤–∫–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π
- `notifications` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `reviews` - –æ—Ç–∑—ã–≤—ã

‚úÖ **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**
- `scheduled_reminders` - –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
- `review_moderation` - –º–æ–¥–µ—Ä–∞—Ü–∏—è –æ—Ç–∑—ã–≤–æ–≤
- `call_logs` - –ª–æ–≥–∏ –∑–≤–æ–Ω–∫–æ–≤
- `pending_ratings` - –æ–∂–∏–¥–∞—é—â–∏–µ –æ—Ü–µ–Ω–∫–∏
- `moderation_rules` - –ø—Ä–∞–≤–∏–ª–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
- `notification_settings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- `push_tokens` - —Ç–æ–∫–µ–Ω—ã –¥–ª—è push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

‚úÖ **–ê–¥–º–∏–Ω —Ç–∞–±–ª–∏—Ü—ã:**
- `admin_users` - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã
- `admin_sessions` - —Å–µ—Å—Å–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

## üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–± –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Supabase Dashboard (–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π)

1. **–ü—Ä–æ–¥–∞–∫—à–µ–Ω –ø—Ä–æ–µ–∫—Ç** (qmbavgwkxtqudchuahdv):
   ```
   https://supabase.com/dashboard/project/qmbavgwkxtqudchuahdv
   Settings ‚Üí Database ‚Üí Backups ‚Üí Download backup
   ```

2. **–¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç** (ruuseponrzonvyyqpdsc):
   ```
   https://supabase.com/dashboard/project/ruuseponrzonvyyqpdsc
   SQL Editor ‚Üí New query ‚Üí –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª ‚Üí Run
   ```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ—à–∞–≥–æ–≤–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

1. **–ü–æ–ª—É—á–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü:**
   - –í—ã–ø–æ–ª–Ω–∏—Ç–µ `SQL/simple_export_schema.sql` –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

2. **–°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—ã –≤ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥–µ:**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è CREATE TABLE –∑–∞–ø—Ä–æ—Å–æ–≤

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã)
npm install @supabase/supabase-js

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
node scripts/copy-database.js --sample-data
```

## üìù –ü—Ä–∏–º–µ—Ä CREATE TABLE –∑–∞–ø—Ä–æ—Å–æ–≤

–û—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ —Ç–∏–ø–∏—á–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ, –≤–æ—Ç –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü:

```sql
-- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    phone VARCHAR(20) UNIQUE NOT NULL,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    middle_name VARCHAR(100),
    birth_date DATE NOT NULL,
    role VARCHAR(20) NOT NULL CHECK (role IN ('customer', 'worker')),
    profile_image TEXT,
    city VARCHAR(100),
    preferred_language VARCHAR(5) DEFAULT 'ru',
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞–∫–∞–∑–æ–≤
CREATE TABLE orders (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    title VARCHAR(200) NOT NULL,
    description TEXT NOT NULL,
    category VARCHAR(100) NOT NULL,
    location VARCHAR(200) NOT NULL,
    latitude DECIMAL(10, 8),
    longitude DECIMAL(11, 8),
    budget INTEGER NOT NULL,
    workers_needed INTEGER DEFAULT 1,
    service_date TIMESTAMPTZ NOT NULL,
    photos TEXT[],
    customer_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    status VARCHAR(20) DEFAULT 'new' CHECK (status IN ('new', 'in_progress', 'completed', 'cancelled')),
    applicants_count INTEGER DEFAULT 0,
    transport_paid BOOLEAN DEFAULT false,
    meal_included BOOLEAN DEFAULT false,
    meal_paid BOOLEAN DEFAULT false,
    auto_completed BOOLEAN DEFAULT false,
    auto_cancelled BOOLEAN DEFAULT false,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞—è–≤–æ–∫
CREATE TABLE applicants (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    order_id UUID NOT NULL REFERENCES orders(id) ON DELETE CASCADE,
    worker_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    worker_name VARCHAR(200) NOT NULL,
    worker_phone VARCHAR(20) NOT NULL,
    rating DECIMAL(3,2),
    completed_jobs INTEGER DEFAULT 0,
    message TEXT,
    proposed_price INTEGER,
    applied_at TIMESTAMPTZ DEFAULT NOW(),
    status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'accepted', 'rejected', 'cancelled')),
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE(order_id, worker_id)
);

-- –¢–∞–±–ª–∏—Ü–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
CREATE TABLE notifications (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    title VARCHAR(200) NOT NULL,
    message TEXT NOT NULL,
    type VARCHAR(50) NOT NULL,
    is_read BOOLEAN DEFAULT false,
    data JSONB,
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

## üîí RLS –ü–æ–ª–∏—Ç–∏–∫–∏

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü, –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –≤–∫–ª—é—á–∏—Ç—å RLS –∏ —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏:

```sql
-- –í–∫–ª—é—á–∞–µ–º RLS –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE orders ENABLE ROW LEVEL SECURITY;
ALTER TABLE applicants ENABLE ROW LEVEL SECURITY;
ALTER TABLE notifications ENABLE ROW LEVEL SECURITY;

-- –ü—Ä–∏–º–µ—Ä—ã –ø–æ–ª–∏—Ç–∏–∫ (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–µ)
CREATE POLICY "Users can view own profile" ON users FOR SELECT USING (auth.uid()::text = id);
CREATE POLICY "Users can update own profile" ON users FOR UPDATE USING (auth.uid()::text = id);

CREATE POLICY "Orders are viewable by everyone" ON orders FOR SELECT USING (true);
CREATE POLICY "Users can create orders" ON orders FOR INSERT WITH CHECK (auth.uid()::text = customer_id);
CREATE POLICY "Customers can update own orders" ON orders FOR UPDATE USING (auth.uid()::text = customer_id);
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è

–ü–æ—Å–ª–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø–∏—Å–µ–π
SELECT 'users' as table_name, COUNT(*) as count FROM users
UNION ALL
SELECT 'orders', COUNT(*) FROM orders
UNION ALL  
SELECT 'applicants', COUNT(*) FROM applicants
UNION ALL
SELECT 'notifications', COUNT(*) FROM notifications;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ RLS –ø–æ–ª–∏—Ç–∏–∫
SELECT tablename, policyname, cmd FROM pg_policies WHERE schemaname = 'public';

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π
SELECT 
    tc.table_name,
    kcu.column_name,
    ccu.table_name AS foreign_table_name,
    ccu.column_name AS foreign_column_name
FROM information_schema.table_constraints tc
JOIN information_schema.key_column_usage kcu ON tc.constraint_name = kcu.constraint_name
JOIN information_schema.constraint_column_usage ccu ON ccu.constraint_name = tc.constraint_name
WHERE tc.constraint_type = 'FOREIGN KEY' AND tc.table_schema = 'public';
```

## üé≠ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–º–µ—Å—Ç–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö:

```sql
-- –¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
INSERT INTO users (phone, first_name, last_name, birth_date, role, city, preferred_language) VALUES
('+998901111111', '–¢–µ—Å—Ç', '–ó–∞–∫–∞–∑—á–∏–∫', '1990-01-01', 'customer', '–¢–∞—à–∫–µ–Ω—Ç', 'ru'),
('+998902222222', '–¢–µ—Å—Ç', '–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å', '1985-05-15', 'worker', '–¢–∞—à–∫–µ–Ω—Ç', 'uz'),
('+998903333333', '–ê–¥–º–∏–Ω', '–¢–µ—Å—Ç–æ–≤—ã–π', '1980-12-25', 'customer', '–¢–∞—à–∫–µ–Ω—Ç', 'ru');

-- –¢–µ—Å—Ç–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã
INSERT INTO orders (title, description, category, location, budget, workers_needed, service_date, customer_id, status) 
SELECT 
    '–¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑ ' || generate_series,
    '–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞ –Ω–æ–º–µ—Ä ' || generate_series,
    CASE (generate_series % 4) 
        WHEN 0 THEN '–£–±–æ—Ä–∫–∞'
        WHEN 1 THEN '–†–µ–º–æ–Ω—Ç' 
        WHEN 2 THEN '–î–æ—Å—Ç–∞–≤–∫–∞'
        ELSE '–î—Ä—É–≥–æ–µ'
    END,
    '–¢–∞—à–∫–µ–Ω—Ç, —Ä–∞–π–æ–Ω ' || generate_series,
    (generate_series * 10000 + 50000),
    (generate_series % 3 + 1),
    NOW() + (generate_series || ' days')::interval,
    (SELECT id FROM users WHERE role = 'customer' LIMIT 1),
    CASE (generate_series % 3)
        WHEN 0 THEN 'new'
        WHEN 1 THEN 'in_progress'
        ELSE 'completed'
    END
FROM generate_series(1, 10);
```

## üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ä–µ–¥—É

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:

```bash
# –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ä–µ–¥—É
./switch-environment.sh dev

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
cd osonish-mobile && npm run start:dev
cd osonish-admin && npm run dev
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Supabase Dashboard
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ connection strings  
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ `DATABASE_MIGRATION_GUIDE.md` –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é  
**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** $(date)
