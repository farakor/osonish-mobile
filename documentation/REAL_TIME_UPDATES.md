# Real-Time Updates Implementation

Реализована система обновлений в режиме реального времени для улучшения пользовательского опыта.

## Проблема

Ранее пользователям приходилось:
- Обновлять экраны вручную
- Переходить на другие экраны и возвращаться, чтобы увидеть изменения
- Не видеть результаты действий сразу после их выполнения

## Решение

### 1. useFocusEffect

Добавлен во все основные экраны для автоматического обновления данных при возврате:

- **OrderDetailsScreen** - обновляет данные заказа и откликов при возврате с ApplicantsListScreen
- **ApplicantsListScreen** - обновляет список откликов при возврате на экран
- **CustomerHomeScreen** - уже был, улучшен
- **MyOrdersScreen** - уже был, улучшен

### 2. Real-Time Subscriptions через Supabase

Добавлены подписки на изменения в базе данных:

#### OrderDetailsScreen
- Отслеживает изменения конкретного заказа (`orders` table)
- Отслеживает изменения откликов для заказа (`applicants` table)

#### ApplicantsListScreen  
- Отслеживает изменения заказа
- Отслеживает изменения всех откликов для заказа

#### CustomerHomeScreen
- Отслеживает все заказы пользователя
- Отслеживает изменения откликов (влияют на счетчик)

#### MyOrdersScreen
- Отслеживает все заказы пользователя
- Отслеживает изменения откликов (влияют на статус заказов)

### 3. Global OrdersContext

Создан глобальный Context для синхронизации состояния между экранами:

**Функции:**
- `refreshOrders()` - обновление всех заказов
- `updateOrderInCache()` - обновление конкретного заказа в кэше
- `addOrderToCache()` - добавление нового заказа
- `removeOrderFromCache()` - удаление заказа
- `updateApplicantInOrder()` - обновление статуса отклика

**Real-time обновления:**
- Глобальная подписка на изменения заказов пользователя
- Глобальная подписка на изменения откликов

## Файлы изменены

### Экраны
- `src/screens/customer/OrderDetailsScreen.tsx`
- `src/screens/customer/ApplicantsListScreen.tsx` 
- `src/screens/customer/CustomerHomeScreen.tsx`
- `src/screens/customer/MyOrdersScreen.tsx`

### Новые файлы
- `src/hooks/OrdersContext.tsx` - Context для управления состоянием
- `src/hooks/index.ts` - экспорт Context

### Конфигурация
- `App.tsx` - добавлен OrdersProvider

## Результат

Теперь пользователи видят изменения мгновенно:

1. **Принятие отклика** - статус сразу обновляется на всех экранах
2. **Создание нового заказа** - появляется в списках автоматически  
3. **Изменение статуса заказа** - отражается везде в реальном времени
4. **Новые отклики** - счетчики обновляются автоматически

## Логирование

Добавлено подробное логирование для отладки:
- Подключение/отключение real-time подписок
- Получение обновлений через Supabase
- Обновления локального кэша

## Производительность

- Используются unique channel names для избежания конфликтов
- Подписки создаются только для авторизованных пользователей
- Автоматическая очистка подписок при размонтировании компонентов
- Эффективное кэширование данных в Context

## Использование

Система работает автоматически после установки. Никаких дополнительных действий от пользователя не требуется.

Для разработчиков: используйте `useOrders()` hook для доступа к глобальному состоянию заказов в новых компонентах.