/**
 * –°–∫—Ä–∏–ø—Ç –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ SMS –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
 * –î–æ–±–∞–≤–ª—è–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é FORCE_PRODUCTION_SMS=true –≤ .env
 */

const fs = require('fs');
const path = require('path');

const enableProductionSMS = () => {
  console.log('üöÄ –í–ö–õ–Æ–ß–ï–ù–ò–ï –†–ï–ê–õ–¨–ù–´–• SMS –í –ü–†–ò–õ–û–ñ–ï–ù–ò–ò');
  console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n');

  const envPath = path.join(__dirname, '.env');
  
  try {
    // –ß–∏—Ç–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π .env —Ñ–∞–π–ª
    let envContent = '';
    if (fs.existsSync(envPath)) {
      envContent = fs.readFileSync(envPath, 'utf8');
      console.log('‚úÖ –ù–∞–π–¥–µ–Ω —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π .env —Ñ–∞–π–ª');
    } else {
      console.log('‚ö†Ô∏è –§–∞–π–ª .env –Ω–µ –Ω–∞–π–¥–µ–Ω, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π');
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è FORCE_PRODUCTION_SMS
    const forceProductionRegex = /^FORCE_PRODUCTION_SMS=.*$/m;
    
    if (forceProductionRegex.test(envContent)) {
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
      envContent = envContent.replace(forceProductionRegex, 'FORCE_PRODUCTION_SMS=true');
      console.log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è FORCE_PRODUCTION_SMS');
    } else {
      // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
      if (envContent && !envContent.endsWith('\n')) {
        envContent += '\n';
      }
      envContent += '\n# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö SMS (–¥–∞–∂–µ –≤ dev —Ä–µ–∂–∏–º–µ)\nFORCE_PRODUCTION_SMS=true\n';
      console.log('‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è FORCE_PRODUCTION_SMS');
    }

    // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π .env —Ñ–∞–π–ª
    fs.writeFileSync(envPath, envContent);
    
    console.log('\n‚úÖ –†–ï–ê–õ–¨–ù–´–ï SMS –í–ö–õ–Æ–ß–ï–ù–´!');
    console.log('üìã –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:');
    console.log('   ‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è FORCE_PRODUCTION_SMS=true');
    console.log('   ‚Ä¢ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ SMS –¥–∞–∂–µ –≤ dev —Ä–µ–∂–∏–º–µ');
    console.log('   ‚Ä¢ SMS –∫–æ–¥—ã –±–æ–ª—å—à–µ –Ω–µ –±—É–¥—É—Ç –≤—ã–≤–æ–¥–∏—Ç—å—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å');
    
    console.log('\nüîÑ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:');
    console.log('1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (npm start)');
    console.log('2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é/–≤—Ö–æ–¥');
    console.log('3. SMS –¥–æ–ª–∂–Ω—ã –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –Ω–æ–º–µ—Ä–∞');
    
    console.log('\n‚ö†Ô∏è –í–ê–ñ–ù–û:');
    console.log('‚Ä¢ –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–∞–Ω—Å–∞ –≤ Eskiz');
    console.log('‚Ä¢ –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–≤–æ–∏—Ö –Ω–æ–º–µ—Ä–∞—Ö');
    console.log('‚Ä¢ –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —ç—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ –Ω—É–∂–Ω–∞');

    console.log('\nüîß –î–õ–Ø –û–¢–ö–õ–Æ–ß–ï–ù–ò–Ø:');
    console.log('–ò–∑–º–µ–Ω–∏—Ç–µ FORCE_PRODUCTION_SMS=false –∏–ª–∏ —É–¥–∞–ª–∏—Ç–µ —ç—Ç—É —Å—Ç—Ä–æ–∫—É –∏–∑ .env');

  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞:', error.message);
    console.log('\nüîß –ü–æ–ø—Ä–æ–±—É–π—Ç–µ:');
    console.log('1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É .env');
    console.log('2. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª .env –≤—Ä—É—á–Ω—É—é');
    console.log('3. –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É: FORCE_PRODUCTION_SMS=true');
  }
};

// –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∫—Ä–∏–ø—Ç
enableProductionSMS();
